---
import { fetchVacancies, buildVacancySlug } from '../../vacancies.mjs'
import { fetchLocales, setCurrentLocale, slugBuilder } from '../../datocms.mjs'
import get from 'just-safe-get'
import BaseLayout from '../../layouts/BaseLayout.astro'
import TopNav from '../../components/TopNav.astro'
import Footer from '../../components/Footer.astro'
import Progress from '../../components/Progress.astro'
import Container from '../../components/Container.vue'
import RoundButton from '../../components/RoundButton.vue'

function createSlug(str) {
  return str
    .toLowerCase() // Convert to lowercase
    .replace(/[^a-z0-9]+/g, '-') // Replace non-alphanumeric characters with hyphens
    .replace(/-+/g, '-') // Replace multiple consecutive hyphens with a single hyphen
    .replace(/^-|-$/g, ''); // Remove leading and trailing hyphens
}

export async function getStaticPaths() {
  const locales = await fetchLocales()
  const data = await fetchVacancies()

  return locales.reduce((pages, locale) => {
    return [
      ...pages,
      ...data.map(vacancy => ({
        params: {
          slug: buildVacancySlug(vacancy, locale),
        },
        props: {
          vacancy,
          locale,
        },
      })),
    ]
  }, [])
}

const { vacancy, locale } = Astro.props
setCurrentLocale(locale)
const logos = {
  academy: 'academy.svg',
  cdis: 'cdis.svg',
  isw: 'cdis.svg',
  isq: 'isq.svg',
  tis: 'tis.svg',
  wyis: 'wyis.svg',
  yhis: 'yhis.svg',
}
const logo = `/assets/logos/${logos[vacancy.entity?.short_name?.toLowerCase()] || 'lpwl.svg'}`
const utmContent = `${vacancy.slug || ''} ${locale}`
  .toLowerCase() // Convert to lowercase
  .replace(/[^a-z0-9]+/g, '+') // Replace non-alphanumeric characters with +
---

<BaseLayout locale={locale}>
  <Fragment slot="head">
    <title>{vacancy.display} | Careers | LifePlus®</title>
    <meta name="description" content="Some description goes here." />
  </Fragment>
  <div id="menu-container"></div>
  <div id="wrapper" class="bg-white text-black font-sans antialiased min-h-screen flex flex-col justify-between">
    <TopNav currentId="tVaLASf5Qo6giokT7yeu8g" locale={locale} />
    <main class="flex-1 relative z-0">
      <section class="bg-brand-base lg:pt-12 shadow" id="section-1">
        <Container class="relative">
          <div class="illustration hidden md:flex w-1/2 bottom-0 absolute z-10 right-0 justify-end items-start" style="top:auto; bottom:auto; width:60%;">
            <img class="w-full" srcset="https://www.datocms-assets.com/65472/1650905449-contact.png?dpr=0.25&amp;fm=webp&amp;w=600 150w,https://www.datocms-assets.com/65472/1650905449-contact.png?dpr=0.5&amp;fm=webp&amp;w=600 300w,https://www.datocms-assets.com/65472/1650905449-contact.png?dpr=0.75&amp;fm=webp&amp;w=600 450w,https://www.datocms-assets.com/65472/1650905449-contact.png?fm=webp&amp;w=600 600w,https://www.datocms-assets.com/65472/1650905449-contact.png?dpr=1.5&amp;fm=webp&amp;w=600 900w,https://www.datocms-assets.com/65472/1650905449-contact.png?dpr=2&amp;fm=webp&amp;w=600 1200w,https://www.datocms-assets.com/65472/1650905449-contact.png?dpr=3&amp;fm=webp&amp;w=600 1800w,https://www.datocms-assets.com/65472/1650905449-contact.png?dpr=4&amp;fm=webp&amp;w=600 2400w" alt="A group of adults in conversation">
          </div>

          <div class="pb-8">
            <a class="inline-flex" href="{{ site:url }}">
              <img class="w-36 md:w-48 lg:w-60" src={logo} alt={vacancy.entity?.name} />
              <span class="sr-only">{vacancy.entity?.name}</span>
            </a>
          </div>
          <h1 class="font-bold text-5xl lg:text-7xl md:w-3/5 lg:pb-20">{vacancy.display}</h1>

          <div class={`hidden md:block relative top-8 lg:mt-10'`}>
            <a  href={`https://apply.lifeplusworldwide.com/a/interest?utm_source=lifeplus&utm_content=${utmContent}+masthead&source_id=1`} target="_blank" class="group inline-flex flex-col text-center text-brand-primary text-sm font-medium">
              <div class="mb-2">Apply</div>
              <RoundButton solid={true} class="transition-transform duration-200 group-hover:scale-110 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512" class="w-6 h-6"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg>
              </RoundButton>
            </a>
          </div>
        </Container>
      </section>

      <section class="py-12">
        <Container>
          <div class="max-w-2xl mx-auto">
            <div class="mb-8">
              <h2 class="text-lg font-medium">{vacancy.entity?.name}{vacancy.entity?.country ? `, ${vacancy.entity?.country}` : ''}</h2>
              {vacancy.entity?.website && <a href={`${vacancy.entity?.website}?utm_source=lifeplus&utm_campaign=careers&utm_content=${utmContent}`} target="_blank" class="text-brand-primary hover:underline inline-flex items-center space-x-1.5">
                <span>Learn more about us…</span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512" class="w-3 h-3 text-gray-500"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg>
              </a>}
            </div>
            <div class="prose lg:prose-lg max-w-none mb-6" set:html={vacancy.job_code?.job_summary || '<p><strong>We are LifePlus, a company of world-class educators.</strong> We inspire learners of all ages to go and make a life-changing difference for the common good. As a global community, we are deeply committed to the people and cultures we serve as we deliver holistic educational services that grow servant leaders of outstanding character, competence and calling—for generations to come.</p>'}></div>
            <a href="/careers#listing" class="group inline-flex items-center text-brand-primary group"><span class="w-8 h-8 flex items-center justify-center rounded-full bg-brand-primary transition ltr:group-hover:-translate-x-2 rtl:group-hover:translate-x-2"><svg class="rtl:hidden w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg><svg class="ltr:hidden w-4 h-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg></span><span class="text-sm ms-4 font-medium">Back to careers…</span></a>
          </div>
        </Container>
      </section>

      <section id="section-3" class="relative  text-white bg-no-repeat bg-cover bg-center" style="z-index: 1; background-image: url(&quot;https://www.datocms-assets.com/65472/1649842554-rasalkhaimah.jpg&quot;);">
        <div class="absolute inset-0 z-[1]" style="background-color: rgba(0, 0, 0, 0.5019607843137255)"></div>
        <div class="relative z-10">
          <div class="py-12">
            <div class="max-w-6xl w-full mx-auto px-4">
              <h2 class="text-sm font-medium pb-10" style="color:#FFFFFF;">Follow your calling</h2>
              <div class="max-w-[34rem] mx-auto py-12 lg:py-20">
                <div class="text-2xl lg:text-4xl lg:leading-[48px] text-brand-base centered-content mb-12"><p>Help us inspire learners <br>of all ages to go and make <br>a life-changing difference <br>for the common good.</p></div>
                <a target="_blank" href={`https://apply.lifeplusworldwide.com/a/interest?utm_source=lifeplus&utm_content=${utmContent}+footer&source_id=1`} class="group inline-flex items-center space-x-4 lg:space-x-8 text-2xl lg:text-4xl font-bold">
                  <span>Apply now…</span>
                  <div class="flex-1 h-12 w-12 lg:w-16 lg:h-16 mx-auto flex items-center justify-center rounded-full bg-white text-brand-primary transition-transform group-hover:scale-110 duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512" class="w-5 h-5 fill-current"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <Footer />
    <Progress />
  </div>
</BaseLayout>