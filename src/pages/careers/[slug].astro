---
import shuffle from 'just-shuffle'
import { fetchVacancies, buildVacancySlug } from '../../vacancies.mjs'
import { fetchLocales, setCurrentLocale, slugBuilder } from '../../datocms.mjs'
import random from 'just-random'
import BaseLayout from '../../layouts/BaseLayout.astro'
import TopNav from '../../components/TopNav.astro'
import Footer from '../../components/Footer.astro'
import Progress from '../../components/Progress.astro'
import Container from '../../components/Container.vue'
import ShareButton from '../../components/ShareButton.vue'


export async function getStaticPaths() {
  const locales = await fetchLocales()
  const vacancies = await fetchVacancies()

  return locales.reduce((pages, locale) => {
    return [
      ...pages,
      ...vacancies.map(vacancy => ({
        params: {
          slug: buildVacancySlug(vacancy, locale),
        },
        props: {
          vacancy,
          locale,
          vacancies,
        },
      })),
    ]
  }, [])
}

const { vacancy, locale, vacancies } = Astro.props
setCurrentLocale(locale)
const logos = {
  academy: 'academy.svg',
  cdis: 'cdis.svg',
  isw: 'cdis.svg',
  isq: 'isq.svg',
  tis: 'tis.svg',
  tws: 'tws.svg',
  wyis: 'wyis.svg',
  yhis: 'yhis.svg',
}
const photos = {
  academy: ['lpoa-1.jpg', 'lpoa-2.jpg', 'lpoa-3.jpg'],
  cdis: ['cdis-1.jpg', 'cdis-2.jpg', 'cdis-3.jpg'],
  isw: ['isw-1.jpg', 'isw-2.jpg', 'isw-3.jpg'],
  isq: ['isq-1.jpg', 'isq-2.jpg', 'isq-3.jpg'],
  tis: ['tis-1.jpg', 'tis-2.jpg', 'tis-3.jpg'],
  tws: ['tws-1.jpg', 'tws-2.jpg', 'tws-3.jpg'],
  wyis: ['wyis-1.jpg', 'wyis-2.jpg', 'wyis-3.jpg'],
  yhis: ['yhis-1.jpg', 'yhis-2.jpg', 'yhis-3.jpg'],
}
const logo = `/assets/logos/${logos[vacancy.entity?.short_name?.toLowerCase()] || 'lpwl.svg'}`
const utmContent = `${vacancy.slug || ''} ${locale}`
  .toLowerCase() // Convert to lowercase
  .replace(/[^a-z0-9]+/g, '+') // Replace non-alphanumeric characters with +

const countryOpenings = shuffle(vacancies).filter(v => v.entity?.country === vacancy.entity?.country)
  .splice(0, 3)
const randomOpenings = countryOpenings.length === 0 ? shuffle(vacancies).splice(0, 3) : countryOpenings

const featured = `/assets/schools/${random(photos[vacancy.entity?.short_name?.toLowerCase()] || photos[random(Object.keys(photos))])}`
---

<BaseLayout locale={locale}>
  <Fragment slot="head">
    <title>{vacancy.display} | Careers | LifePlus®</title>
    <meta name="description" content="Some description goes here." />
  </Fragment>
  <Fragment slog="footer">
    <script type="module" src="https://unpkg.com/ionicons@latest/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@latest/dist/ionicons/ionicons.js"></script>
  </Fragment>

  <div id="menu-container"></div>
  <div id="wrapper" class="bg-white text-black font-sans antialiased min-h-screen flex flex-col justify-between">
    <TopNav currentId="tVaLASf5Qo6giokT7yeu8g" locale={locale} />

    <main class="flex-1 relative z-0">
      <div class="pb-10 bg-white shadow z-10 relative">
        <Container>
          <div class="grid lg:grid-cols-3" id="section-1">
            <div class="pt-10">
              <div class="w-1/2">
                <img src={logo} alt={vacancy.entity?.name}>
              </div>

              <div class="lg:w-3/4 lg:pe-4 lg:mt-12 mb-4 lg:mb-0">
                <a href="/careers#listing?utm_source=career+listing&utm_content=aside+back" class="group inline-flex items-center text-brand-primary group mb-4">
                  <span class="w-8 h-8 flex items-center justify-center rounded-full bg-brand-primary transition ltr:group-hover:-translate-x-2 rtl:group-hover:translate-x-2">
                    <ion-icon class="rtl:hidden w-4 h-4 text-white" name="arrow-back-outline"></ion-icon>
                    <ion-icon class="ltr:hidden w-4 h-4 text-white" name="arrow-forward-outline"></ion-icon>
                  </span>
                  <span class="text-sm ms-4 font-medium">Back to careers</span>
                </a>

                <div class="lg:border-t border-gray-300">
                  <p class="font-medium text-sm py-2">Other openings in {vacancy.entity?.country}</p>
                  <ul>
                    {randomOpenings.map(related => (
                      <li class="mb-5">
                        <p class="text-sm">{related.entity?.name}</p>
                        <p class="text-lg font-medium">{related.display}</p>
                        <a href={`/careers/${buildVacancySlug(related, locale)}`} class="group text-sm text-brand-primary font-medium inline-flex items-center">
                          <span>View</span>
                          <ion-icon class="w-4 h-4 ms-1.5 transition ltr:group-hover:translate-x-1 rtl:group-hover:-translate-x-1" name="arrow-forward-circle"></ion-icon>
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>

                <div class="lg:border-t border-gray-300 text-end">
                  <a href={`https://apply.lifepluslearning.com/a/interest?utm_source=lifeplus+corporate&utm_content=${utmContent}+sidebar&source_id=1`} target="_blank" class="group inline-flex items-center text-brand-primary group mt-4">
                    <span class="text-sm me-4 font-medium">Apply now</span>
                    <span class="w-8 h-8 flex items-center justify-center rounded-full bg-brand-primary transition group-hover:scale-110">
                      <ion-icon class="w-4 h-4 text-white" name="open-outline"></ion-icon>
                    </span>
                  </a>
                </div>
              </div>
            </div>

            <div class="lg:col-span-2 lg:ps-4 lg:border-s border-gray-300">
              <img src={featured} alt={vacancy.entity?.name} class="block w-full">

              <div class="mt-6">
                <h1 class="border-t font-bold border-gray-300 py-1.5 text-3xl md:text-4xl">
                  {vacancy.display}
                </h1>
                <p class="border-y border-gray-300 pt-1.5 pb-5 text-3xl md:text-4xl">
                  {vacancy.entity?.name}{vacancy.entity?.country ? `, ${vacancy.entity?.country}` : ''}
                </p>
              </div>

              <div class="pt-12 pb-12 md:pb-24 relative">
                <div class="prose prose-lg max-w-none" set:html={vacancy.job_code?.job_summary || '<p><strong>We are LifePlus, a company of world-class educators.</strong> We inspire learners of all ages to go and make a life-changing difference for the common good. As a global community, we are deeply committed to the people and cultures we serve as we deliver holistic educational services that grow servant leaders of outstanding character, competence and calling—for generations to come.</p>'}></div>

                <div class="hidden lg:block absolute right-0 bottom-0">
                  <div class="px-4 text-brand-primary text-sm font-medium text-center">
                    <div class="mb-2">Share</div>
                    <ShareButton client:idle url={`${Astro.request.url}?utm_content=footer+share&utm_medium=desktop`} />
                  </div>
                </div>
              </div>

              <section class="block-link_columns relative pb-12 text-black">
                <h2 class="text-sm font-medium pb-10">Your next step</h2>
                <div class="grid grid-cols-1 md:grid-cols-2  gap-8">
                  <div class="border-b border-gray-300">
                    <a href={`${vacancy.entity?.website || '/schools'}?utm_source=lifeplus+careers&utm_content=learn+more+footer`} target="_blank" class="flex justify-between items-center group border-y border-gray-300">
                      <h4 class="text-2xl md:text-4xl leading-[2.5rem] md:leading-[3rem] text-brand-primary">Learn more</h4>
                      <span>
                        <div class="h-6 w-6 md:w-8 md:h-8 flex items-center justify-center rounded-full bg-brand-primary text-white transition-transform group-hover:translate-x-2 rtl:group-hover:-translate-x-2 duration-200">
                          <ion-icon class="w-4 md:w-5 h-4 md:h-5 rtl:hidden md flip-rtl hydrated" role="img" name="arrow-forward-outline"></ion-icon>
                          <ion-icon class="w-4 md:w-5 h-4 md:h-5 hidden rtl:block md flip-rtl hydrated" role="img" name="arrow-back-outline"></ion-icon>
                        </div>
                      </span>
                    </a>
                    <div class="text-lg md:text-2xl pt-1 pb-4 md:pb-6">Learn more about {vacancy.entity?.name}.</div>
                  </div>
                  <div class="border-b border-gray-300">
                    <a href={`https://apply.lifeplusworldwide.com/a/interest?utm_source=lifeplus&utm_content=${utmContent}+footer&source_id=1`} target="_blank" class="flex justify-between items-center group border-y border-gray-300">
                      <h4 class="text-2xl md:text-4xl leading-[2.5rem] md:leading-[3rem] text-brand-primary">Apply</h4>
                      <span>
                        <div class="h-6 w-6 md:w-8 md:h-8 flex items-center justify-center rounded-full bg-brand-primary text-white transition-transform group-hover:translate-x-2 rtl:group-hover:-translate-x-2 duration-200">
                          <ion-icon class="w-4 md:w-5 h-4 md:h-5 rtl:hidden md flip-rtl hydrated" role="img" name="arrow-forward-outline"></ion-icon>
                          <ion-icon class="w-4 md:w-5 h-4 md:h-5 hidden rtl:block md flip-rtl hydrated" role="img" name="arrow-back-outline"></ion-icon>
                        </div>
                      </span>
                    </a>
                    <div class="text-lg md:text-2xl pt-1 pb-4 md:pb-6">Start your application today.</div>
                  </div>
                </div>
              </section>
          </div>
        </Container>
      </div>

      <section id="section-2" class="relative  text-white bg-no-repeat bg-cover bg-center" style="z-index: 1; background-image: url(&quot;https://www.datocms-assets.com/65472/1649842554-rasalkhaimah.jpg&quot;);">
        <div class="absolute inset-0 z-[1]" style="background-color: rgba(0, 0, 0, 0.5019607843137255)"></div>
        <div class="relative z-10">
          <div class="py-12">
            <div class="max-w-6xl w-full mx-auto px-4">
              <h2 class="text-sm font-medium pb-10" style="color:#FFFFFF;">Follow your calling</h2>
              <div class="max-w-[34rem] mx-auto py-12 lg:py-20">
                <div class="text-2xl lg:text-4xl lg:leading-[48px] text-brand-base centered-content mb-12"><p>Help us inspire learners <br>of all ages to go and make <br>a life-changing difference <br>for the common good.</p></div>
                <a target="_blank" href={`https://apply.lifeplusworldwide.com/a/interest?utm_source=lifeplus&utm_content=${utmContent}+footer&source_id=1`} class="group inline-flex items-center space-x-4 lg:space-x-8 text-2xl lg:text-4xl font-bold">
                  <span>Apply now…</span>
                  <div class="flex-1 h-12 w-12 lg:w-16 lg:h-16 mx-auto flex items-center justify-center rounded-full bg-white text-brand-primary transition-transform group-hover:scale-110 duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512" class="w-5 h-5 fill-current"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <Footer />
    <Progress />
  </div>
</BaseLayout>