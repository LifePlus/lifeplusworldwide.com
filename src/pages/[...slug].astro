---
import { fetchPages } from '../datocms.mjs'
import get from 'just-safe-get'
import BasePageLayout from '../layouts/BasePageLayout.astro'
import Component from '../components/Component.vue'
import ModularContentItem from '../components/ModularContentItem.astro'

export async function getStaticPaths() {
  const data = await fetchPages()
  const pages = get(data, 'data.allPages', [])
  const faviconTags = get(data, 'data._site.faviconMetaTags')

  return pages.map(page => ({
    params: page.slug === 'home'
      ? { slug: '/' }
      : { slug: page.slug },
    props: {
      page,
      faviconTags,
    }
  }))
}

const { page, faviconTags } = Astro.props
const blocks = get(page, 'modularContent', [])
---

<BasePageLayout pageId={page.id}>
  <Fragment slot="head">
    {faviconTags.map(element => <Component config={element} />)}
    {page._seoMetaTags.map(element => <Component config={element} />)}
  </Fragment>

  {blocks.map((content, index) => <ModularContentItem content={content} index={blocks.length - index} section={index + 1} />)}
</BasePageLayout>