---
import { fetchPages } from '../datocms.mjs'
import get from 'just-safe-get'
import { ray } from 'node-ray'
import BasePageLayout from '../layouts/BasePageLayout.astro'
import Component from '../components/Component.vue'
import ModularContentItem from '../components/ModularContentItem.astro'

export async function getStaticPaths() {
  const data = await fetchPages()
  const pages = get(data, 'data.allPages', [])
  const faviconTags = get(data, 'data._site.faviconMetaTags')

  return pages.map(page => ({
    params: page.slug === 'home'
      ? {}
      : { slug: page.slug },
    props: {
      page,
      faviconTags,
    }
  }))
}

const { page, faviconTags } = Astro.props

ray(page)
---

<BasePageLayout pageId={page.id}>
  <Fragment slot="head">
    {faviconTags.map(element => <Component config={element} />)}
    {page._seoMetaTags.map(element => <Component config={element} />)}
  </Fragment>

  {get(page, 'modularContent', []).map(content => <ModularContentItem content={content} />)}
</BasePageLayout>