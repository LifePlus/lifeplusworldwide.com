---
import { fetchPages } from '../datocms.mjs'
import get from 'just-safe-get'
import { ray } from 'node-ray'

export async function getStaticPaths() {
  const data = await fetchPages()
  const pages = get(data, 'data.allPages', [])
  const faviconTags = get(data, 'data._site.faviconMetaTags')
  console.log('called getStaticPaths', import.meta.env.DATOCMS_KEY)

  return pages.map(page => ({
    params: page.slug === 'home'
      ? {}
      : { slug: page.slug },
    props: {
      page,
      faviconTags,
    }
  }))
}

import BasePageLayout from '../layouts/BasePageLayout.astro'
import Component from '../components/Component.vue'
const { slug } = Astro.request.params
const { page, faviconTags } = Astro.props

console.log(`DatoCMS KEY: ${import.meta.env.DATOCMS_KEY}`)
ray(page)
---

<BasePageLayout pageId={page.id}>
  <Fragment slot="head">
    {faviconTags.map(element => <Component config={element} />)}
    {page._seoMetaTags.map(element => <Component config={element} />)}
  </Fragment>

  {page.id}
</BasePageLayout>